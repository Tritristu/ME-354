import pandas as pd
import numpy as np
from os import listdir
from scipy.stats import linregress

# aterial Constants
steelElasticMod = 192.73856228694635e9
steelPoisson = 0.35225704496405114
steelYield = 540.981570199884e6

aluminumElasticMod = 73.25376489150618e9
aluminumPoisson = 0.2769261455092313
aluminumYield = 298.6339832889318e6

# Experimental Data
Files = [x for x in listdir('TorsionLab\StrainHardening') if '.csv' in x]
Steel = [x for x in listdir('TorsionLab\StrainHardening') if '1018' in x]
Aluminum = [x for x in listdir('TorsionLab\StrainHardening') if '6061' in x]

Data = {x:{} for x in Files}
for File in Files:
    Data[File] = pd.read_csv('TorsionLab\StrainHardening\\'+File)

# Fitting Strain Equation
def hardeningFit(Strain, Stress, a, b, strainOffset):
    elasticMod, intercept, R, P, Err = linregress(Strain[a:b], Stress[a:b])
    yP = next(i for i, x in enumerate(Strain) if Stress[i] < elasticMod * (x - strainOffset) + intercept)
    logStrain = np.log10(Strain)
    print(logStrain)
    logStress = np.log10(Stress)
    n, C, R, P, Err = linregress(logStrain[yP+5:len(Strain)-5], logStress[yP+5:len(Stress)-5])  # The data outputs the slope (n), intercept (C), regression (R) value, P-value and standard error
    return C,n

# test = hardeningFit(Files[Aluminum[0]]['Strain (mm/mm)'],Files[Aluminum[0]]['Stress (MPa)'],aluminumElasticMod,10,50,0.002) #fix index out of range error
# hardeningConstants = {}
# for File in Files:
#     hardeningCoeff,hardeningExp = hardeningFit() 
#     hardeningConstants[File] = [hardeningCoeff,hardeningExp]

# df.to_csv(r'TorsionLab\StrainHardening\\coefficients.csv', index=False)



